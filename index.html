<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Today's To‑Do with Timers</title>
  <style>
    :root{
      --bg:#0f1724; --card:#111827; --accent:#06b6d4; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);
      --success:#10b981; --danger:#ef4444; --radius:12px; --gap:14px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#031224 0%, #071124 100%);color:#e6eef6}
    .wrap{max-width:980px;margin:28px auto;padding:20px}

    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    p.lead{margin:6px 0 0;color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:20px}

    /* left column - tasks */
    .panel{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .task-list{display:flex;flex-direction:column;gap:12px}
    .task{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border:1px solid rgba(255,255,255,0.02)}
    .task .meta{flex:1}
    .task h3{margin:0;font-size:15px}
    .task p{margin:6px 0 0;color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--glass);border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px 10px;border-radius:8px;cursor:pointer;font-size:13px}
    button.primary{background:linear-gradient(90deg,var(--accent),#7dd3fc);color:#022; border:none}
    button.ghost{background:transparent;border:1px dashed rgba(255,255,255,0.04)}
    .time{min-width:88px;text-align:center;font-weight:600}

    /* right column - presets + add */
    .sidebar h4{margin:0 0 10px 0}
    .presets{display:flex;gap:8px;flex-wrap:wrap}
    .preset{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer}

    form.add{display:flex;flex-direction:column;gap:8px}
    input,select{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;color:inherit}

    .footer{margin-top:18px;display:flex;gap:10px;align-items:center;justify-content:space-between;color:var(--muted);font-size:13px}

    /* small screens */
    @media (max-width:860px){
      .grid{grid-template-columns:1fr;}
      .sidebar{order:2}
    }

    /* little status badges */
    .badge{font-size:12px;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);color:var(--muted)}

    /* nice focus */
    button:focus,input:focus,select:focus{outline:2px solid rgba(6,182,212,0.12);outline-offset:2px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Today's To‑Do & Timers</h1>
        <p class="lead">A focused list for today — quick start timers, pause/resume and save to your browser.</p>
      </div>
      <div style="text-align:right">
        <div class="badge" id="dateBadge"></div>
      </div>
    </header>

    <div class="grid">
      <section class="panel">
        <h4 style="margin:0 0 10px 0">Tasks</h4>
        <div class="task-list" id="tasks">
          <!-- tasks populated by JS -->
        </div>

        <div class="footer">
          <div>Session total: <span id="sessionTotal">00:00:00</span></div>
          <div>
            <button id="clearAll" class="ghost">Clear completed</button>
          </div>
        </div>
      </section>

      <aside class="panel sidebar">
        <h4>Quick presets</h4>
        <div class="presets">
          <div class="preset" data-min="25">25 min</div>
          <div class="preset" data-min="50">50 min</div>
          <div class="preset" data-min="15">15 min</div>
          <div class="preset" data-min="5">5 min</div>
        </div>

        <hr style="opacity:.06;margin:12px 0;border:none;height:1px;background:rgba(255,255,255,0.03)">

        <h4>Add / edit task</h4>
        <form id="addForm" class="add" onsubmit="return false;">
          <input id="taskTitle" placeholder="Task title (required)" required />
          <input id="taskNote" placeholder="Optional note (e.g. chapters/sections)" />
          <div style="display:flex;gap:8px">
            <input id="taskMinutes" type="number" placeholder="minutes" min="1" style="flex:1" />
            <select id="taskPriority" style="width:120px">
              <option value="normal">Normal</option>
              <option value="high">High priority</option>
            </select>
          </div>
          <div style="display:flex;gap:8px">
            <button id="addBtn" class="primary">Add task</button>
            <button id="addStartBtn" class="ghost">Add + Start</button>
          </div>
        </form>

        <div style="height:8px"></div>
        <div style="color:var(--muted);font-size:13px">Tips: Click a preset to fill minutes. Tasks persist locally in this browser.</div>
      </aside>
    </div>
  </div>

  <script>
    // Initial tasks provided from user's list
    const defaultTasks = [
      {title: "Derivatives, Integration & call 11 chapters", note: "Study calculus: derivatives & integrals, finish call 11 chapters", minutes: 90, priority: 'high'},
      {title: "Aldehydes & ketone", note: "Organic chemistry: reactions + mechanisms", minutes: 60, priority: 'normal'},
      {title: "RD SHM OPTICS", note: "Revision: RD, SHM, Optics — practice problems", minutes: 80, priority: 'high'}
    ];

    const STORAGE_KEY = 'todo-with-timers-v1';
    const tasksEl = document.getElementById('tasks');
    const dateBadge = document.getElementById('dateBadge');
    const sessionTotalEl = document.getElementById('sessionTotal');

    // show date
    const now = new Date();
    dateBadge.textContent = now.toLocaleString(undefined, {weekday:'short', month:'short', day:'numeric'});

    // load tasks
    function load(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return defaultTasks.map(t=>createTaskObject(t));
      try{const parsed = JSON.parse(raw); return parsed.map(t=>createTaskObject(t));}catch(e){return defaultTasks.map(t=>createTaskObject(t));}
    }

    function save(tasks){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks.map(stripRuntime)));
    }

    function createTaskObject(data){
      return Object.assign({
        id: 't'+Math.random().toString(36).slice(2,9),
        title:'',note:'',minutes:25,remaining:0, running:false, completed:false, priority:'normal',startedAt:null
      }, data, {remaining: (data.remaining ?? (data.minutes*60)), startedAt: data.startedAt ?? null});
    }

    function stripRuntime(t){
      return {id:t.id,title:t.title,note:t.note,minutes:t.minutes,remaining:t.remaining,completed:t.completed,priority:t.priority,startedAt:t.startedAt};
    }

    let tasks = load();
    if(tasks.length===0){ tasks = defaultTasks.map(t=>createTaskObject(t)); }

    // Render
    function render(){
      tasksEl.innerHTML = '';
      tasks.forEach(t => tasksEl.appendChild(renderTask(t)));
      save(tasks);
      updateSessionTotal();
    }

    function renderTask(t){
      const wrap = document.createElement('div'); wrap.className='task';

      const meta = document.createElement('div'); meta.className='meta';
      const h = document.createElement('h3'); h.textContent = t.title;
      const p = document.createElement('p'); p.textContent = t.note || (t.minutes + ' min');
      meta.appendChild(h); meta.appendChild(p);

      const controls = document.createElement('div'); controls.className='controls';
      const time = document.createElement('div'); time.className='time'; time.id = 'time-'+t.id; time.textContent = formatSec(t.remaining);

      const start = document.createElement('button'); start.textContent = t.running ? 'Pause' : 'Start'; start.onclick = ()=>toggleStart(t.id);
      if(t.running) start.classList.add('primary');
      const reset = document.createElement('button'); reset.textContent = 'Reset'; reset.onclick = ()=>resetTask(t.id);
      const done = document.createElement('button'); done.textContent = t.completed ? 'Undo' : 'Done'; done.onclick = ()=>toggleDone(t.id);

      controls.appendChild(time); controls.appendChild(start); controls.appendChild(reset); controls.appendChild(done);

      wrap.appendChild(meta); wrap.appendChild(controls);

      if(t.priority === 'high'){
        const b = document.createElement('div'); b.style.marginLeft='8px'; b.innerHTML = '<span class="badge">High</span>';
        wrap.insertBefore(b,controls);
      }

      if(t.completed){ wrap.style.opacity = '0.5'; wrap.style.textDecoration = 'line-through'; }
      return wrap;
    }

    // helpers
    function formatSec(s){ if(s==null) s=0; s = Math.max(0,Math.floor(s)); const h = Math.floor(s/3600); const m = Math.floor((s%3600)/60); const sec = s%60; return (h?String(h).padStart(2,'0')+':':'') + String(m).padStart(2,'0') + ':' + String(sec).padStart(2,'0'); }

    function findTask(id){ return tasks.find(x=>x.id===id); }

    // timer controls
    let ticker = null;
    function startTicker(){ if(ticker) return; ticker = setInterval(tick,1000); }
    function stopTicker(){ if(ticker){ clearInterval(ticker); ticker = null; } }

    function tick(){
      let anyRunning = false;
      for(const t of tasks){ if(t.running && !t.completed){ anyRunning = true; t.remaining = Math.max(0, (t.remaining - 1)); if(t.remaining===0){ t.running=false; // finished
            // small browser notification
            if(Notification && Notification.permission==='granted'){
              new Notification('Timer finished', {body: t.title});
            }
          }
        }
      }
      // update DOM times
      tasks.forEach(t => { const el=document.getElementById('time-'+t.id); if(el) el.textContent = formatSec(t.remaining); });
      if(!anyRunning) stopTicker();
      save(tasks);
      updateSessionTotal();
    }

    function toggleStart(id){ const t = findTask(id); if(!t) return; if(t.completed) return; t.running = !t.running; if(t.running && t.remaining<=0) t.remaining = t.minutes*60; if(t.running) t.startedAt = Date.now(); render(); startTicker(); }
    function resetTask(id){ const t = findTask(id); if(!t) return; t.running=false; t.remaining = t.minutes*60; t.completed=false; render(); }
    function toggleDone(id){ const t = findTask(id); if(!t) return; t.completed = !t.completed; t.running = false; render(); }

    // Add tasks
    document.getElementById('addBtn').addEventListener('click', ()=>{
      const title = document.getElementById('taskTitle').value.trim(); if(!title) return alert('Enter a title');
      const note = document.getElementById('taskNote').value.trim(); const minutes = parseInt(document.getElementById('taskMinutes').value) || 25; const priority = document.getElementById('taskPriority').value;
      const t = createTaskObject({title,note,minutes,remaining:minutes*60,priority}); tasks.push(t); render(); document.getElementById('addForm').reset();
    });

    document.getElementById('addStartBtn').addEventListener('click', ()=>{
      const title = document.getElementById('taskTitle').value.trim(); if(!title) return alert('Enter a title');
      const note = document.getElementById('taskNote').value.trim(); const minutes = parseInt(document.getElementById('taskMinutes').value) || 25; const priority = document.getElementById('taskPriority').value;
      const t = createTaskObject({title,note,minutes,remaining:minutes*60,priority, running:true}); tasks.push(t); render(); startTicker(); document.getElementById('addForm').reset();
    });

    // preset clicks
    document.querySelectorAll('.preset').forEach(p=>p.addEventListener('click', e=>{
      const m = parseInt(e.currentTarget.dataset.min); document.getElementById('taskMinutes').value = m;
    }));

    document.getElementById('clearAll').addEventListener('click', ()=>{
      tasks = tasks.filter(t=>!t.completed);
      render();
    });

    // session total (sum of remaining of non-completed)
    function updateSessionTotal(){ const total = tasks.reduce((s,t)=> t.completed? s: s + (t.remaining||0),0); sessionTotalEl.textContent = formatSec(total); }

    // request Notification permission once
    if('Notification' in window && Notification.permission !== 'granted'){
      try{ Notification.requestPermission().then(()=>{}); }catch(e){}
    }

    // initialize
    render();
    // start any running timers on load
    if(tasks.some(t=>t.running)) startTicker();

    // expose utilities for console / debugging
    window._TODOS = {tasks,save,render};
  </script>
</body>
</html>
